<!DOCTYPE html>
<html>
<head>
    <title>Teste StateManager - Configura√ß√µes de Troca de Ativos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { margin: 5px; padding: 8px 15px; }
    </style>
</head>
<body>
    <h1>üß™ Teste do StateManager - Configura√ß√µes de Troca de Ativos</h1>
    
    <div class="test-section">
        <h3>1. Teste de Carregamento do StateManager</h3>
        <button onclick="testStateManagerLoad()">Testar Carregamento</button>
        <div id="load-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. Teste de Configura√ß√µes Padr√£o</h3>
        <button onclick="testDefaultConfig()">Verificar Configura√ß√µes Padr√£o</button>
        <div id="default-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. Teste de Salvamento de Configura√ß√µes de Troca de Ativos</h3>
        <button onclick="testSaveAssetConfig()">Salvar Configura√ß√µes de Teste</button>
        <div id="save-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>4. Teste de Carregamento de Configura√ß√µes de Troca de Ativos</h3>
        <button onclick="testLoadAssetConfig()">Carregar Configura√ß√µes</button>
        <div id="load-asset-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>5. Teste de M√©todos Espec√≠ficos de Troca de Ativos</h3>
        <button onclick="testAssetMethods()">Testar M√©todos</button>
        <div id="methods-result" class="result"></div>
    </div>

    <script src="src/content/state-manager.js"></script>
    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.innerHTML = message;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function testStateManagerLoad() {
            try {
                if (typeof window.StateManager === 'undefined') {
                    log('load-result', '‚ùå StateManager n√£o est√° dispon√≠vel', 'error');
                    return;
                }
                
                if (window.StateManager && typeof window.StateManager.getConfig === 'function') {
                    log('load-result', '‚úÖ StateManager carregado com sucesso!', 'success');
                } else {
                    log('load-result', '‚ùå StateManager carregado mas m√©todos n√£o dispon√≠veis', 'error');
                }
            } catch (error) {
                log('load-result', `‚ùå Erro ao testar StateManager: ${error.message}`, 'error');
            }
        }

        function testDefaultConfig() {
            try {
                const config = window.StateManager.getConfig();
                
                if (!config) {
                    log('default-result', '‚ùå Nenhuma configura√ß√£o retornada', 'error');
                    return;
                }
                
                let result = '‚úÖ Configura√ß√µes padr√£o carregadas:<br>';
                result += `‚Ä¢ Automa√ß√£o: ${config.automation}<br>`;
                result += `‚Ä¢ Payout M√≠nimo: ${config.minPayout}%<br>`;
                result += `‚Ä¢ Comportamento Payout: ${config.payoutBehavior}<br>`;
                
                if (config.assetSwitching) {
                    result += `‚Ä¢ Troca de Ativos Habilitada: ${config.assetSwitching.enabled}<br>`;
                    result += `‚Ä¢ Categoria Preferida: ${config.assetSwitching.preferredCategory}<br>`;
                    result += `‚Ä¢ Payout M√≠nimo para Troca: ${config.assetSwitching.minPayout}%<br>`;
                } else {
                    result += '‚Ä¢ ‚ö†Ô∏è Configura√ß√µes de troca de ativos n√£o encontradas<br>';
                }
                
                log('default-result', result, 'success');
            } catch (error) {
                log('default-result', `‚ùå Erro ao verificar configura√ß√µes padr√£o: ${error.message}`, 'error');
            }
        }

        async function testSaveAssetConfig() {
            try {
                const testConfig = {
                    gale: { active: true, level: '1.2x' },
                    dailyProfit: 150,
                    stopLoss: 30,
                    automation: false,
                    value: 10,
                    period: 1,
                    minPayout: 80,
                    payoutBehavior: 'switch',
                    payoutTimeout: 60,
                    assetSwitching: {
                        enabled: true,
                        minPayout: 90,
                        preferredCategory: 'currency',
                        checkBeforeAnalysis: true,
                        checkBeforeTrade: true,
                        maxRetries: 3
                    }
                };
                
                const success = await window.StateManager.saveConfig(testConfig);
                
                if (success) {
                    log('save-result', '‚úÖ Configura√ß√µes de teste salvas com sucesso!', 'success');
                } else {
                    log('save-result', '‚ùå Falha ao salvar configura√ß√µes de teste', 'error');
                }
            } catch (error) {
                log('save-result', `‚ùå Erro ao salvar configura√ß√µes: ${error.message}`, 'error');
            }
        }

        async function testLoadAssetConfig() {
            try {
                const config = await window.StateManager.loadConfig();
                
                if (!config || !config.assetSwitching) {
                    log('load-asset-result', '‚ùå Configura√ß√µes de troca de ativos n√£o encontradas', 'error');
                    return;
                }
                
                let result = '‚úÖ Configura√ß√µes de troca de ativos carregadas:<br>';
                result += `‚Ä¢ Habilitada: ${config.assetSwitching.enabled}<br>`;
                result += `‚Ä¢ Payout M√≠nimo: ${config.assetSwitching.minPayout}%<br>`;
                result += `‚Ä¢ Categoria Preferida: ${config.assetSwitching.preferredCategory}<br>`;
                result += `‚Ä¢ Verificar antes da An√°lise: ${config.assetSwitching.checkBeforeAnalysis}<br>`;
                result += `‚Ä¢ Verificar antes da Opera√ß√£o: ${config.assetSwitching.checkBeforeTrade}<br>`;
                result += `‚Ä¢ M√°ximo de Tentativas: ${config.assetSwitching.maxRetries}<br>`;
                
                log('load-asset-result', result, 'success');
            } catch (error) {
                log('load-asset-result', `‚ùå Erro ao carregar configura√ß√µes: ${error.message}`, 'error');
            }
        }

        function testAssetMethods() {
            try {
                let result = '‚úÖ Testando m√©todos espec√≠ficos de troca de ativos:<br>';
                
                // Teste 1: getAssetSwitchingConfig
                const assetConfig = window.StateManager.getAssetSwitchingConfig();
                result += `‚Ä¢ getAssetSwitchingConfig(): ${assetConfig ? '‚úÖ OK' : '‚ùå FALHOU'}<br>`;
                
                // Teste 2: isAssetSwitchingEnabled
                const isEnabled = window.StateManager.isAssetSwitchingEnabled();
                result += `‚Ä¢ isAssetSwitchingEnabled(): ${isEnabled} ‚úÖ<br>`;
                
                // Teste 3: getMinPayoutForAssets
                const minPayout = window.StateManager.getMinPayoutForAssets();
                result += `‚Ä¢ getMinPayoutForAssets(): ${minPayout}% ‚úÖ<br>`;
                
                // Teste 4: getPreferredAssetCategory
                const category = window.StateManager.getPreferredAssetCategory();
                result += `‚Ä¢ getPreferredAssetCategory(): ${category} ‚úÖ<br>`;
                
                log('methods-result', result, 'success');
            } catch (error) {
                log('methods-result', `‚ùå Erro ao testar m√©todos: ${error.message}`, 'error');
            }
        }

        // Executar teste inicial ao carregar a p√°gina
        window.addEventListener('load', () => {
            setTimeout(() => {
                testStateManagerLoad();
                setTimeout(() => testDefaultConfig(), 500);
            }, 100);
        });
    </script>
</body>
</html> 